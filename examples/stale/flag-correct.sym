principal A B

def secAdd v =
  let sa  = share [yao, â„• : A â†’ {A,B}] v@A in
  let sb  = share [yao, â„• : B â†’ {A,B}] v@B in
  let sum = sa + sb in
  let r   = reveal [yao, â„• : {A,B} â†’ A] sum in
  r

def plainAdd v =
  let a   = send [â„• : A â†’ {A,B}] v@A in
  let b   = send [â„• : B â†’ {A,B}] v@B in
  let sum = a + b in
  sum

def main () = par {A,B}
  let fa = send [ğ”¹ : A â†’ {A,B}] (par {A} read ğ”¹ from "flag-error-flag.txt") in
  let fb = send [ğ”¹ : B â†’ {A,B}] (par {B} read ğ”¹ from "flag-error-flag.txt") in

  let v = âŸª A | par {A} read â„• from "flag-error-val.txt" âŸ« â§º âŸª B | par {B} read â„• from "flag-error-val.txt" âŸ« in

  let out =
    if fa == fb then
      if fa then
        secAdd v
      else
        plainAdd v
    else
      â€¢
  in

  out
