principal A[n] -- Just integers
principal B[m] -- Both integers and queries


-- basic functions

def length :
    list â„¤{bgw:all}
  â†’ â„¤{bgw:all}
def length xs = case xs
  { [] â†’ 0 --share literals?
  ; x::xs â†’ 1 + length xs
  }

def elem :
    â„¤{bgw:all}
  â†’ list â„¤{bgw:all}
  â†’ ğ”¹{bgw:all}
def elem y xs : case xs
  { [] â†’ false
  ; x::xs â†’
    let a = x == y
    let b = elem y xs
    in a || b
  }

def elem-at :
    â„¤{bgw:all}
  â†’ list â„¤{bgw:all}
  â†’ â„¤{bgw:all}

-- query functions

def min :
    list â„¤{bgw:all}
  â†’ â„¤{bgw:all}
def min xs = case xs
  { [x] â†’ x
  ; x::xs â†’
    let y = min xs
    let b = x < y
    in b ? x â—‡ y
  }

def max :
    list â„¤{bgw:all}
  â†’ â„¤{bgw:all}
def max xs = case xs
  { [x] â†’ x
  ; x::xs â†’
    let y = max xs
    let b = x > y
    in b ? x â—‡ y
  }

def median :
    list â„¤{bgw:all}
  â†’ â„¤{bgw:all}
def median xs = -- not implemented

def num-unique :
    list â„¤{bgw:all}
  â†’ â„¤{bgw:all}
def num-unique xs = num-unique-rec xs []

def num-unique-rec :
    list â„¤{bgw:all}
  â†’ list â„¤{bgw:all}
  â†’ â„¤{bgw:all}
def num-unique-rec xs seen = case xs
  { [] â†’ length seen
  ; x::xs â†’
    let b = elem x seen
    in b ? num-unique-rec xs seen â—‡ num-unique-rec xs (x::seen)
  }


-- atq

def run-queries :
    list â„¤{isec:A,B}
  â†’ list â„¤{bgw:all}
def run-queries xs =
  let xsâ€² = share{bgw:all} xs.A â§º share{bgw:all} xs.B
  in (min xsâ€²) :: (max xsâ€²) :: (median xsâ€²) :: (num-unique xsâ€²)

def send-result :
    list â„¤{bgw:all}
  â†’ â„¤{bgw:all}
  â†’ principal C
  â†’ â„¤{ssec:C}
def send-result results index =
  reveal{C} (elem-at index results)

def send-results :
    list â„¤{bgw:all}
  â†’ list (â„¤, list ğ•Š){isec:B}
  â†’ list â„¤{ssec:hmm}
def send-results results qs = case qs
  { [] â†’ []
  ; q:qs â†’ (send-result results (fst q) (parse-prin (snd q))) :: send-results results qs
  }

def main : ğŸ™ â†’{inp:A,B;rev:hmmm} list â„¤{ssec:hmm}
def main âˆ™ =
  let xs = list â„¤{isec:A,B}
  let xs = -- parse input
  let qs = list (â„¤, list ğ•Š){isec:B}
  let qs = -- parse input
  let results = run-queries xs
  in send-results results qs
