<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/Projects/psl/examples/cmp-tutorial.psl.html</title>
<meta name="Generator" content="Vim/8.1">
<meta name="plugin-version" content="vim8.1_v1">
<meta name="syntax" content="pantheon">
<meta name="settings" content="use_css,pre_wrap,no_foldcolumn,expand_tabs,prevent_copy=">
<meta name="colorscheme" content="none">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #000000; background-color: #ffffff; }
body { font-family: monospace; color: #000000; background-color: #ffffff; }
* { font-size: 1em; }
.pantheonKeyword { color: #af5f00; font-weight: bold; }
.pantheonComment { color: #a8a8a8; font-style: italic; }
.pantheonPrimitive { color: #0000c0; }
.pantheonPunctuation { color: #6c6c6c; }
.pantheonOperator { color: #008000; }
.pantheonLiteral { color: #c00000; }
-->
</style>
</head>
<body>
<pre id='vimCodeElement'>
<span class="pantheonComment">{-</span>
<span class="pantheonComment">These lines declare what principles that are present. The type checker</span>
<span class="pantheonComment">(not yet implemented) will make sure that all principles mentioned in</span>
<span class="pantheonComment">types are (at least) well-scoped, and possible also check some</span>
<span class="pantheonComment">security relationships as well, e.g., does A trust B, and to what</span>
<span class="pantheonComment">extent.</span>

<span class="pantheonComment">These lines are ignored by the interpreter.</span>

<span class="pantheonComment">In this example, A and B have secret inputs. C and D will recieve</span>
<span class="pantheonComment">shares of A and B's secret inputs in order to compute over them</span>
<span class="pantheonComment">through an MPC protocol. E and F will then recieve output shares</span>
<span class="pantheonComment">from C and D in order to reconstruct the answer, which is only</span>
<span class="pantheonComment">learned by E and F (not A, B, C or D).</span>
<span class="pantheonComment">-}</span>
<span class="pantheonComment">-- input parties</span>
<span class="pantheonKeyword">principal</span> A
<span class="pantheonKeyword">principal</span> B
<span class="pantheonComment">-- compute parties</span>
<span class="pantheonKeyword">principal</span> C
<span class="pantheonKeyword">principal</span> D
<span class="pantheonComment">-- output parties</span>
<span class="pantheonKeyword">principal</span> E
<span class="pantheonKeyword">principal</span> F

<span class="pantheonComment">{-</span>
<span class="pantheonComment">`cmp` takes a secret input from both `A` and `B` and builds a yao</span>
<span class="pantheonComment">boolean</span>
<span class="pantheonComment">â€œsecret shareâ€ which is (conceptually) immediately sent to (and</span>
<span class="pantheonComment">shared by) C and D. Specifying yao at this point in the program (as</span>
<span class="pantheonComment">opposed to when the final results is â€œrevealedâ€) allows for (e.g.)</span>
<span class="pantheonComment">EMP-style on-they-fly evaluation of a protocol as an optimization.</span>

<span class="pantheonComment">The input variable `xy` has type `â„¤{isec:A,B}`, which reads as â€œtwo</span>
<span class="pantheonComment">integers, one for each party `A` and `B`, as independent (i.e., not</span>
<span class="pantheonComment">necessarily equal) secrets.â€ To access A's value, we write `xy.A`,</span>
<span class="pantheonComment">and likewise for B and `xy.B`. `xy.A` is a secret value, and is (yao)</span>
<span class="pantheonComment">â€œsecret-sharedâ€ (i.e., encrypted and embeddable inside of a circuit)</span>
<span class="pantheonComment">to C and D by `share{yao:C,D} xy.A`. C and D now hold shares of A's</span>
<span class="pantheonComment">secret which will be provided as an input to the next circuit (in</span>
<span class="pantheonComment">this case, a yao garbled circuit with a single comparison) when</span>
<span class="pantheonComment">executed.</span>

<span class="pantheonComment">The return type `ğ”¹{yao:C,D}` reads as â€œA boolean value embedded in a</span>
<span class="pantheonComment">yao secret share that is shared among C and D.â€ The type checker will</span>
<span class="pantheonComment">check for valid operations to be used in a mpc computations. In this</span>
<span class="pantheonComment">example, comparison (â‰¤) is valid because it is supported by the yao</span>
<span class="pantheonComment">prtocol. E.g., it may not be possible to execute a circuit that uses</span>
<span class="pantheonComment">comparisons using bgw, so the type checker would reject a program</span>
<span class="pantheonComment">that tried to do so. In this example, we have already commited to yao</span>
<span class="pantheonComment">but that may not always be the case. Regarding the `{inp:A,B}` part</span>
<span class="pantheonComment">of the function type, this annotation specifies from which parties</span>
<span class="pantheonComment">were secret inputs secret-shared and computed on in some protocol.</span>
<span class="pantheonComment">This enables checking security relationtionships between principles</span>
<span class="pantheonComment">and flagging violations of the trust model. The interpreter ignores</span>
<span class="pantheonComment">input effect annotations such as this.</span>

<span class="pantheonComment">The first two steps of `cmp` embed secret inputs from A and B into</span>
<span class="pantheonComment">yao â€œsecret-sharesâ€. The last step is a normal comparison operator</span>
<span class="pantheonComment">which is overloaded syntactically to operate over secret share values</span>
<span class="pantheonComment">by executing the protocol over the secret-share. Since we are using</span>
<span class="pantheonComment">yao, we can use the `â‰¤` operator unlike in say, bgw, where comparison</span>
<span class="pantheonComment">like this isn't possible. In the future it will be possible to pick</span>
<span class="pantheonComment">whether or not protocol execution operaties on-the-fly with small</span>
<span class="pantheonComment">circuits (e.g., in EMP), or as one large circuit in a single</span>
<span class="pantheonComment">protocol. So conceptually `ğ”¹{yao:C,D}` is a secret share, and `x â‰¤ y`</span>
<span class="pantheonComment">executes a circuit of size 1, but in practice `ğ”¹{yao:C,D}` could be a</span>
<span class="pantheonComment">circuit constucted by each party, `x â‰¤ y` builds a larger circuit out</span>
<span class="pantheonComment">of smaller ones, and execution of the protocol is delayed until some</span>
<span class="pantheonComment">later point.</span>

<span class="pantheonComment">-}</span>
<span class="pantheonKeyword">def</span> cmp <span class="pantheonPunctuation">:</span> <span class="pantheonPrimitive">â„¤</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">isec</span><span class="pantheonPunctuation">:</span>A<span class="pantheonPunctuation">,</span>B<span class="pantheonPunctuation">}</span> <span class="pantheonPunctuation">â†’{</span><span class="pantheonPrimitive">inp</span><span class="pantheonPunctuation">:</span>A<span class="pantheonPunctuation">,</span>B<span class="pantheonPunctuation">}</span> <span class="pantheonPrimitive">ğ”¹</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">yao</span><span class="pantheonPunctuation">:</span>C<span class="pantheonPunctuation">,</span>D<span class="pantheonPunctuation">}</span>
<span class="pantheonKeyword">def</span> cmp <span class="pantheonPunctuation">=</span> <span class="pantheonKeyword">Î»</span> xy <span class="pantheonPunctuation">â†’</span>
  <span class="pantheonKeyword">let</span> x <span class="pantheonPunctuation">:</span> <span class="pantheonPrimitive">â„¤</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">yao</span><span class="pantheonPunctuation">:</span>C<span class="pantheonPunctuation">,</span>D<span class="pantheonPunctuation">}</span>
  <span class="pantheonKeyword">let</span> x <span class="pantheonPunctuation">=</span> <span class="pantheonKeyword">share</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">yao</span><span class="pantheonPunctuation">:</span>C<span class="pantheonPunctuation">,</span>D<span class="pantheonPunctuation">}</span> xy<span class="pantheonPunctuation">.</span>A
  <span class="pantheonKeyword">let</span> y <span class="pantheonPunctuation">:</span> <span class="pantheonPrimitive">â„¤</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">yao</span><span class="pantheonPunctuation">:</span>A<span class="pantheonPunctuation">,</span>B<span class="pantheonPunctuation">}</span>
  <span class="pantheonKeyword">let</span> y <span class="pantheonPunctuation">=</span> <span class="pantheonKeyword">share</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">yao</span><span class="pantheonPunctuation">:</span>C<span class="pantheonPunctuation">,</span>D<span class="pantheonPunctuation">}</span> xy<span class="pantheonPunctuation">.</span>B
  <span class="pantheonKeyword">let</span> r <span class="pantheonPunctuation">:</span> <span class="pantheonPrimitive">ğ”¹</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">yao</span><span class="pantheonPunctuation">:</span>C<span class="pantheonPunctuation">,</span>D<span class="pantheonPunctuation">}</span>
  <span class="pantheonKeyword">let</span> r <span class="pantheonPunctuation">=</span> x <span class="pantheonOperator">â‰¤</span> y
  <span class="pantheonKeyword">in</span> r
<span class="pantheonComment">{-</span>

<span class="pantheonComment">The access mode `isec` is distinguished from `ssec`, which reads as</span>
<span class="pantheonComment">&quot;shared secret&quot;, in that `ssec` values have the added invariant that</span>
<span class="pantheonComment">all parties have a local copy of the exact same value. E.g., when a</span>
<span class="pantheonComment">result from mpc is revealed to some subset of parties.</span>

<span class="pantheonComment">-}</span>
<span class="pantheonKeyword">def</span> cmp-mpc <span class="pantheonPunctuation">:</span> <span class="pantheonPrimitive">ğŸ™</span> <span class="pantheonPunctuation">â†’{</span><span class="pantheonPrimitive">inp</span><span class="pantheonPunctuation">:</span>A<span class="pantheonPunctuation">,</span>B<span class="pantheonPunctuation">;</span><span class="pantheonPrimitive">rev</span><span class="pantheonPunctuation">:</span>E<span class="pantheonPunctuation">,</span>F<span class="pantheonPunctuation">}</span> <span class="pantheonPrimitive">ğ”¹</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">ssec</span><span class="pantheonPunctuation">:</span>E<span class="pantheonPunctuation">,</span>F<span class="pantheonPunctuation">}</span>
<span class="pantheonKeyword">def</span> cmp-mpc <span class="pantheonPunctuation">=</span> <span class="pantheonKeyword">Î»</span> <span class="pantheonOperator">â€¢</span> <span class="pantheonPunctuation">â†’</span>
  <span class="pantheonKeyword">let</span> xy <span class="pantheonPunctuation">:</span> <span class="pantheonPrimitive">â„¤</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">isec</span><span class="pantheonPunctuation">:</span>A<span class="pantheonPunctuation">,</span>B<span class="pantheonPunctuation">}</span>
  <span class="pantheonKeyword">let</span> xy <span class="pantheonPunctuation">=</span> <span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">par</span><span class="pantheonPunctuation">:</span>A<span class="pantheonPunctuation">,</span>B<span class="pantheonPunctuation">}</span> <span class="pantheonPrimitive">read</span> <span class="pantheonPrimitive">â„¤</span> <span class="pantheonLiteral">&quot;e1-input.txt&quot;</span>
  <span class="pantheonKeyword">let</span> r <span class="pantheonPunctuation">:</span> <span class="pantheonPrimitive">ğ”¹</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">yao</span><span class="pantheonPunctuation">:</span>C<span class="pantheonPunctuation">,</span>D<span class="pantheonPunctuation">}</span>
  <span class="pantheonKeyword">let</span> r <span class="pantheonPunctuation">=</span> cmp xy
  <span class="pantheonKeyword">let</span> o <span class="pantheonPunctuation">:</span> <span class="pantheonPrimitive">ğ”¹</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">ssec</span><span class="pantheonPunctuation">:</span>E<span class="pantheonPunctuation">,</span>F<span class="pantheonPunctuation">}</span>
  <span class="pantheonKeyword">let</span> o <span class="pantheonPunctuation">=</span> <span class="pantheonKeyword">reveal</span><span class="pantheonPunctuation">{</span>E<span class="pantheonPunctuation">,</span>F<span class="pantheonPunctuation">}</span> r
  <span class="pantheonKeyword">in</span> o

<span class="pantheonKeyword">def</span> one-liner <span class="pantheonPunctuation">:</span> <span class="pantheonPrimitive">ğŸ™</span> <span class="pantheonPunctuation">â†’{</span><span class="pantheonPrimitive">inp</span><span class="pantheonPunctuation">:</span>A<span class="pantheonPunctuation">,</span>B<span class="pantheonPunctuation">;</span><span class="pantheonPrimitive">rev</span><span class="pantheonPunctuation">:</span>E<span class="pantheonPunctuation">,</span>F<span class="pantheonPunctuation">}</span> <span class="pantheonPrimitive">ğ”¹</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">ssec</span><span class="pantheonPunctuation">:</span>E<span class="pantheonPunctuation">,</span>F<span class="pantheonPunctuation">}</span>
<span class="pantheonKeyword">def</span> one-liner <span class="pantheonPunctuation">=</span> <span class="pantheonKeyword">Î»</span> <span class="pantheonOperator">â€¢</span> <span class="pantheonPunctuation">â†’</span>
  <span class="pantheonKeyword">let</span> xy <span class="pantheonPunctuation">=</span> <span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">par</span><span class="pantheonPunctuation">:</span>A<span class="pantheonPunctuation">,</span>B<span class="pantheonPunctuation">}</span> <span class="pantheonPrimitive">read</span> <span class="pantheonPrimitive">â„¤</span> <span class="pantheonLiteral">&quot;e1-input.txt&quot;</span>
  <span class="pantheonKeyword">in</span> <span class="pantheonKeyword">reveal</span><span class="pantheonPunctuation">{</span>E<span class="pantheonPunctuation">,</span>F<span class="pantheonPunctuation">}</span> <span class="pantheonPunctuation">(</span><span class="pantheonKeyword">share</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">yao</span><span class="pantheonPunctuation">:</span>C<span class="pantheonPunctuation">,</span>D<span class="pantheonPunctuation">}</span> xy<span class="pantheonPunctuation">.</span>A<span class="pantheonPunctuation">)</span> <span class="pantheonOperator">â‰¤</span> <span class="pantheonPunctuation">(</span><span class="pantheonKeyword">share</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">yao</span><span class="pantheonPunctuation">:</span>C<span class="pantheonPunctuation">,</span>D<span class="pantheonPunctuation">}</span> xy<span class="pantheonPunctuation">.</span>B<span class="pantheonPunctuation">)</span>

<span class="pantheonKeyword">def</span> main <span class="pantheonPunctuation">:</span> <span class="pantheonPrimitive">ğ”¹</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">ssec</span><span class="pantheonPunctuation">:</span>A<span class="pantheonPunctuation">,</span>B<span class="pantheonPunctuation">}</span> <span class="pantheonOperator">Ã—</span> <span class="pantheonPrimitive">ğ”¹</span><span class="pantheonPunctuation">{</span><span class="pantheonPrimitive">ssec</span><span class="pantheonPunctuation">:</span>A<span class="pantheonPunctuation">,</span>B<span class="pantheonPunctuation">}</span>
<span class="pantheonKeyword">def</span> main <span class="pantheonPunctuation">=</span> cmp-mpc <span class="pantheonOperator">â€¢</span> <span class="pantheonPunctuation">,</span> one-liner <span class="pantheonOperator">â€¢</span>
</pre>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
