principal A
principal B

def list-cond : 
    ğ”¹{bcir:A,B} 
  â†’ list â„¤{bcir:A,B}
  â†’ list â„¤{bcir:A,B} 
  â†’ list â„¤{bcir:A,B}
def list-cond = rÎ» rec b â†’ Î» xs â†’ Î» ys â†’ case xs,ys
  { [],_ â†’ ys
  ; _,[] â†’ xs
  ; xâˆ·xsâ€²,yâˆ·ysâ€² â†’ circuit b ? x â—‡ y âˆ· rec bsâ€² xsâ€² ysâ€²
  }

def split : list â„¤{par:A,B} â†’ list â„¤{par:A,B} Ã— list â„¤{par:A,B}
def split = rÎ» rec xs â†’ case xs
  { [] â†’ [] , []
  ; [x] â†’ [] , [x]
  ; xâ‚âˆ·xâ‚‚âˆ·xs â†’
      let xsâ‚,xsâ‚‚ = rec xs in
      xâ‚âˆ·xsâ‚,xâ‚‚âˆ·xsâ‚‚
  }

def merge : 
    list â„¤{bcir:A,B}
  â†’ list â„¤{bcir:A,B}
  â†’ list â„¤{bcir:A,B}
def merge = rÎ» rec xs â†’ Î» ys â†’
  case xs,ys
  { [],_ â†’ ys
  ; _,[] â†’ xs
  ; xâˆ·xsâ€²,yâˆ·ysâ€² â†’
      list-cond (circuit x â‰¤ y)
                (circuit x âˆ· rec xsâ€² ys)
                (circuit y âˆ· rec xs ysâ€²)
  }

def msort : list â„¤{par:A,B} â†’ list â„¤{bcir:A,B}
def msort = rÎ» rec xs â†’ case xs 
  { [] â†’ []
  ; [âŸ¨x@A;y@BâŸ©] â†’
      let b = x â‰¤ y in
      [ circuit b ? x â—‡ y , circuit b ? y â—‡ x ]
  ; xâ‚âˆ·xâ‚‚âˆ·xsâ€² â†’
      let xsâ‚ : list â„¤{par:A,B} in
      let xsâ‚‚ : list â„¤{par:A,B} in
      let xsâ‚,xsâ‚‚ = split xs in

      let ysâ‚ : list â„¤{bcir:A,B} in
      let ysâ‚ = rec xsâ‚ in

      let ysâ‚ : list â„¤{bcir:A,B} in
      let ysâ‚‚ = rec xsâ‚‚ in

      merge ysâ‚ ysâ‚‚
  }

def msort-mpc : list â„¤{par:A,B} â†’ MPC{A,B âª« A,B} list â„¤
def msort-mpc = Î» xs â†’ mpc{gmw:A,B} msort xs
